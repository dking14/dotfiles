#!/bin/bash

# Searches the specified directory (default=.) for any .git repos that
# have a dropbox remote defined, and updates it
# Author:: Rob Hurring
# Date:: 2010-12-09 

relroot=${1:-.}
root=`cd $relroot; pwd`

echo -e "\033[37mSearching: \033[1;33m${root}\033[0m"
for i in `find ${root} -name .git`; do
  gitconfig="${i}/config"
  [[ ! -f $gitconfig ]] && continue
  
  `grep 'remote \"dropbox\"' ${gitconfig} > /dev/null`
  if [ $? = 0 ]; then
    dir=`dirname $i`
    app=`basename $dir`
    echo -e "\033[37mUpdating: \033[1;35m${app}:${dir}\033[0m"
    cd $dir && git push dropbox master
    cd $root
    echo
  fi
done